# Maintainer: Pierre Schmitz <pierre@archlinux.de>

pkgname=compat-wireless-brcm80211
_pkgdate='2010-11-17'
_kernver='2.6.35-ARCH'
pkgver="${_pkgdate//-/.}"
pkgrel=1
pkgdesc='FOSS wireless driver for Broadcom BCM4313, BCM43224, BCM43225 chipsets'
arch=('i686' 'x86_64')
url='http://wireless.kernel.org/en/users/Drivers/brcm80211'
license=('GPL2')
depends=('kernel26' 'linux-firmware')
makedepends=('kernel26-headers')
install="${pkgname}.install"
source=("http://wireless.kernel.org/download/compat-wireless-2.6/compat-wireless-${_pkgdate}.tar.bz2")
sha1sums=('30dd711584f7b6e247e4109b84df435a787976f5')

build() {
	cd "${srcdir}/compat-wireless-${_pkgdate}"
	scripts/driver-select brcm80211
	make KLIB="/lib/modules/${_kernver}"
}

package() {
	cd "${srcdir}/compat-wireless-${_pkgdate}"
	make KLIB="/lib/modules/${_kernver}" KMODPATH_ARG="INSTALL_MOD_PATH=${pkgdir}" install-modules
	sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" "${startdir}/${pkgname}.install"
}
